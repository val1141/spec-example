WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'confluence.extra.jira:refresh-resources', location = '/jira/jira-issues-view-mode/refresh-table.js' */
define("confluence/jim/jira/jira-issues-view-mode/refresh-table",["jquery","ajs"],function(d,f){var b={REFRESH_STATE_STARTED:1,REFRESH_STATE_DONE:2,REFRESH_STATE_FAILED:3,refreshs:[],sortables:[],init:function(){e.getAll().each(function(){b.registerRefresh(this.getRefresh())});d.each(this.refreshs,function(a,c){a=e.get(c.id);a.getRefreshButton().bind("click",c,b.handleRefreshClick);a.getRefreshLink().bind("click",c,b.handleRefreshClick);a.getContentModule().is("[data-client-id]")&&b.processRefreshWaiting(c)});
m.getAll().each(function(){b.registerSort(this.getSortable())});d.each(this.sortables,function(a,c){m.get(c.id).getHeadersTable().bind("click",c,b.onHeaderClick)})},onHeaderClick:function(a){a=a.data.id;var c="ASC";d(this).hasClass("tablesorter-headerAsc")&&(c="DESC");var k=d(this).find(".jim-table-header-content").attr("sort-column-key"),h=d(f.format("#refresh-module-{0} .refresh-wiki",a)),g=h.data("wikimarkup");h=h.data("pageid");var l=d("#refresh-"+a);g=new b.Refresh(a,g,h,l.html());e.get(a).updateRefreshVisibility(b.REFRESH_STATE_STARTED);
b.processRefresh(g,!1,k,c)},updateRefreshedElement:function(a,c){var k=a.attr("id").replace("refresh-module-",""),h=d(c),g=h.attr("id")&&h.attr("id").replace("refresh-module-","")||void 0;d.each(this.refreshs,function(l,n){n.id===k&&(g||h.hasClass("jim-error-message")?(e.get(n.id).getContentModule().replaceWith(c),(new b.CallbackSupport(n)).callback(g)):(new b.CallbackSupport(n)).errorHandler(c))})},replaceRefresh:function(a,c){e.get(a).updateRefreshVisibility(b.REFRESH_STATE_DONE,c);d.each(this.refreshs,
function(k,h){if(h.id===a){b.refreshs.splice(k,1);h=e.get(c);var g=h.getRefresh();b.registerRefresh(g);b.sortables.splice(k,1);k=m.get(c);var l=k.getSortable();b.registerSort(l);h.getRefreshButton().bind("click",g,b.handleRefreshClick);h.getRefreshLink().bind("click",g,b.handleRefreshClick);k.getHeadersTable().bind("click",l,b.onHeaderClick)}})},registerRefresh:function(a){if(!(a instanceof b.Refresh))throw "\u041e\u0431\u044a\u0435\u043a\u0442 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440\u043e\u043c RefreshMacro.Refresh";b.refreshs.push(a)},registerSort:function(a){if(!(a instanceof
b.Sortable))throw "\u041e\u0431\u044a\u0435\u043a\u0442 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440\u043e\u043c RefreshMacro.Refresh";b.sortables.push(a)},processRefreshWithData:function(a,c){this.processRefreshWaiting(a,c);b.processRefresh(a,c)},processRefreshWaiting:function(a){var c=e.get(a.id);c.getMacroPanel().html(a.loadingMsg);c.updateRefreshVisibility(b.REFRESH_STATE_STARTED,a.id)},handleRefreshClick:function(a){b.processRefreshWithData(a.data,!0)},processRefresh:function(a,c,k,h){f.$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:Confluence.getContextPath()+
"/rest/jiraanywhere/1.0/jira/renderTable",data:f.$.toJSON({wikiMarkup:encodeURIComponent(a.wiki),clearCache:c,columnName:k,order:h}),success:function(g,l){l=g.data;d(l).hasClass("jim-error-message-table")?(e.get(a.id).removeDarkLayer(),e.get(a.id).getContentModule().replaceWith(l)):(g=d(l).attr("id"))?(g=g.replace("refresh-module-",""),e.get(a.id).getContentModule().replaceWith(l),(new b.CallbackSupport(a)).callback(g)):(new b.CallbackSupport(a)).errorHandler(l)},error:function(g,l,n){(new b.CallbackSupport(a)).errorHandler(n)}})},
Refresh:function(a,c){this.id=a;this.wiki=c;this.pageId=2<arguments.length?arguments[2]:null;this.loadingMsg=3<arguments.length?arguments[3]:null},CallbackSupport:function(a){this.refresh=a;this.module=d("#refresh-module-"+a.id)}};b.CallbackSupport.prototype={errorHandler:function(a){var c=e.get(this.refresh.id),k="\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u043d\u0435 \u0434\u0430\u043b\u043e \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0441\u043d\u043e\u0432\u0430 \u0438\u043b\u0438 \u0449\u0435\u043b\u043a\u043d\u0438\u0442\u0435 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0443, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0435\u0435 \u0432 Jira.";c.getErrorMessagePanel().html(k);c.updateRefreshVisibility(b.REFRESH_STATE_FAILED);f.trigger("confluence.extra.jira:jira-table:completed.error",
{id:-1,error:a})},callback:function(a){b.replaceRefresh(this.refresh.id,a);f.trigger("confluence.extra.jira:jira-table:completed.success",{id:a||-1})}};var e=function(){1==arguments.length&&(this.id=arguments[0])},m=function(){1==arguments.length&&(this.id=arguments[0])};e.prototype.getRefresh=function(){return new b.Refresh(this.id,this.getWikiMarkup(),this.getPageId(),this.getMacroPanel().html())};m.prototype.getSortable=function(){return new b.Sortable(this.id,d("#refresh-page-id-"+this.id).val(),
d("#refresh-"+this.id).html())};e.get=function(a){return d("#refresh-"+a)?new e(a):null};m.get=function(a){return d("#refresh-"+a)?new m(a):null};b.Sortable=function(a,c,k){this.id=a;this.pageId=c;this.loadingMsg=k};m.getAll=function(){return d("div.refresh-macro").map(function(){var a=this.id.replace("refresh-","");return m.get(a)})};e.getAll=function(){return d("div.refresh-macro").map(function(){var a=this.id.replace("refresh-","");return e.get(a)})};e.prototype.getErrorMessagePanel=function(){return d(f.format("#refresh-module-{0} .error-message",
this.id))};e.prototype.removeDarkLayer=function(){d("#jim-dark-layout-"+this.id).remove()};e.prototype.displayDarkLayer=function(){var a=d("#refresh-module-"+this.id);a.position();d("\x3cdiv /\x3e",{id:"jim-dark-layout-"+this.id,"class":"jim-sortable-dark-layout"}).appendTo(a)};e.prototype.getMacroPanel=function(){return d("#refresh-"+this.id)};m.prototype.getMacroPanel=function(){return d("#refresh-"+this.id).val()};e.prototype.getContentModule=function(){return d("#refresh-module-"+this.id)};e.prototype.getPageId=
function(){return d("#refresh-wiki-"+this.id).data("pageid")};m.prototype.getPageId=function(){return d("#refresh-wiki-"+this.id).data("pageid")};e.prototype.getWikiMarkup=function(){return d(f.format("#refresh-module-{0} .refresh-wiki",this.id)).data("wikimarkup")};e.prototype.getRefreshButton=function(){return d(f.format("#refresh-module-{0} .refresh-issues-button",this.id))};e.prototype.getLoadingButton=function(a){return d(f.format("#refresh-module-{0} .refresh-issues-loading",a||this.id))};m.prototype.getHeadersTable=
function(){return d(f.format("#refresh-module-{0} .jira-issues .jira-tablesorter-header",this.id))};e.prototype.getRefreshLink=function(){return d(f.format("#refresh-module-{0} .refresh-issues-link",this.id))};e.prototype.getJiraIssuesArea=function(){return d(f.format("#refresh-module-{0} .jira-issues",this.id))};e.prototype.getIssuesCountArea=function(){return d(f.format("#refresh-module-{0} .total-issues-count",this.id))};e.prototype.updateRefreshVisibility=function(a,c){a===b.REFRESH_STATE_STARTED?
(this.displayDarkLayer(),this.getErrorMessagePanel().addClass("hidden"),this.getRefreshLink().text("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u043f\u0440\u043e\u0431\u043b\u0435\u043c"),this.getRefreshButton().hide(),this.getLoadingButton(c).removeClass("hidden")):a===b.REFRESH_STATE_FAILED?(this.getLoadingButton(c).addClass("hidden"),this.removeDarkLayer(),this.getRefreshButton().show(),this.getRefreshLink().show(),this.getErrorMessagePanel().removeClass("hidden"),this.getRefreshLink().text("\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c")):a===b.REFRESH_STATE_DONE&&
(this.getLoadingButton(c).addClass("hidden"),this.removeDarkLayer(),this.getRefreshButton().show(),this.getRefreshLink().text("\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c"))};return b});
}catch(e){WRMCB(e)};